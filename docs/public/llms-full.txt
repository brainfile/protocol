# Brainfile Protocol - Complete Reference for AI Agents

> Comprehensive documentation for AI agents integrating with Brainfile
> Auto-generated from markdown documentation

Version: 1.0
Schema: https://brainfile.md/v1
Last Updated: 2025-12-18

---

## Table of Contents

1. Quick Start Guide
2. Why Brainfile?
3. Getting Started with Contracts
4. Comprehensive Guide to Contracts
5. Agent Workflow Patterns
6. CLI & Terminal UI
7. MCP Server Integration
8. VSCode Extension
9. Core Library
10. Protocol Specification
11. API Reference
12. CLI Commands Reference
13. Contract Schema Reference
14. Schema Types
15. Complete Example

---

## 1. Quick Start Guide

Quick Start

Get a task board in your project in under a minute.
  Install

``
npm install -g @brainfile/cli
`
  Initialize

`
brainfile init
`

This creates a brainfile.md file with a basic board structure.
  Use It

Option A: Interactive TUI
`
brainfile
`
Navigate with keyboard: TAB for columns, j/k for tasks, Enter to expand, q to quit.

Option B: CLI Commands
`
brainfile list                              # See all tasks
brainfile add --title "My first task"       # Add a task
brainfile move --task task-1 --column done  # Move to done
`

Option C: VSCode Extension
  Install "Brainfile" from the marketplace
  Open your project — the kanban board appears in the sidebar

---

Add AI Integration

Want your AI assistant to manage tasks directly? Add this to .mcp.json in your project:

`
{
  "mcpServers": {
    "brainfile": {
      "command": "npx",
      "args": ["@brainfile/cli", "mcp"]
    }
  }
}
`

Works with Claude Code, Cursor, Cline, and any MCP-compatible tool.

::: tip What can AI do with this?
Your assistant can now list tasks, create new ones, move them between columns, update priorities, and manage subtasks — all without you copy-pasting anything.
:::

---

Agent Coordination (Optional)

Brainfile allows you to create Contracts for your AI assistants. A contract defines exactly what an agent needs to deliver.
  Create a task with a contract

`
brainfile add --title "Create API docs" \
  --with-contract \
  --deliverable "docs/api.md" \
  --validation "npm run docs:build"
`
  How agents use it

When an AI agent (like Claude or Cursor) picks up this task, it will see the structured deliverables and validation` commands. This ensures the agent produces exactly what you need.

---

Next Steps
  - Why Brainfile? — The full story
  - Getting Started with Contracts — 2-minute intro
  - CLI Commands — All available commands
  - MCP Integration — AI assistant setup
  - Protocol Specification — File format details

---

## 2. Why Brainfile?

Why Brainfile?

The Problem with Current Tools

Task management is disconnected from code.

Your tasks live in Linear, Jira, Notion, or GitHub Issues. Your code lives in git. These systems don't talk to each other in any meaningful way. You're the integration layer — copying task IDs into commit messages, manually updating status, context-switching between browser tabs.

AI assistants can't see your tasks.

Claude Code can read your entire codebase. It can see your git history, your test failures, your linter errors. But it has no idea what you're actually working on. You have to explain the task every time, paste in requirements, remind it of the acceptance criteria.

SaaS tools create dependencies.

Offline? Can't access tasks. Team changes? Export headaches. Service goes down? Work stops. Your project metadata lives on someone else's servers, in someone else's format.

---

The Brainfile Approach

Anatomy of a Brainfile

<div class="anatomy-diagram">
  <div class="anatomy-row">
    <div class="anatomy-card">
      <div class="anatomy-title">Metadata</div>
      <div class="anatomy-content">title, schema, version</div>
    </div>
    <div class="anatomy-card">
      <div class="anatomy-title">Agent</div>
      <div class="anatomy-content">instructions, tools</div>
    </div>
    <div class="anatomy-card">
      <div class="anatomy-title">Rules</div>
      <div class="anatomy-content">always, never, prefer</div>
    </div>
  </div>
  <div class="anatomy-connector">
    <div class="connector-line"></div>
    <div class="connector-arrow">▼</div>
  </div>
  <div class="anatomy-row">
    <div class="anatomy-card anatomy-wide">
      <div class="anatomy-title">Columns & Tasks</div>
      <div class="anatomy-content">Your kanban board — todo, in-progress, done</div>
    </div>
  </div>
  <div class="anatomy-connector">
    <div class="connector-line"></div>
    <div class="connector-arrow">▼</div>
  </div>
  <div class="anatomy-row">
    <div class="anatomy-card anatomy-result">
      <div class="anatomy-title">brainfile.md</div>
      <div class="anatomy-content">One file. Human + machine readable.</div>
    </div>
  </div>
</div>

<style>
.anatomy-diagram {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
  margin: 2rem 0;
}
.anatomy-row {
  display: flex;
  gap: 1rem;
  justify-content: center;
  flex-wrap: wrap;
}
.anatomy-card {
  background: var(--vp-c-bg-soft);
  border: 1px solid var(--vp-c-border);
  border-radius: 8px;
  padding: 1rem 1.25rem;
  min-width: 140px;
  text-align: center;
}
.anatomy-card.anatomy-wide {
  min-width: 300px;
}
.anatomy-card.anatomy-result {
  background: var(--vp-c-brand-soft);
  border-color: var(--vp-c-brand-2);
  min-width: 280px;
}
.anatomy-title {
  font-weight: 600;
  color: var(--vp-c-text-1);
  margin-bottom: 0.25rem;
}
.anatomy-content {
  font-size: 0.85rem;
  color: var(--vp-c-text-2);
}
.anatomy-connector {
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 2rem;
}
.connector-line {
  width: 2px;
  height: 1rem;
  background: var(--vp-c-border);
}
.connector-arrow {
  color: var(--vp-c-text-3);
  font-size: 0.75rem;
  line-height: 1;
}
@media (max-width: 640px) {
  .anatomy-row {
    flex-direction: column;
    gap: 0.75rem;
  }
  .anatomy-card {
    min-width: 200px;
    width: 100%;
    max-width: 280px;
  }
  .anatomy-card.anatomy-wide,
  .anatomy-card.anatomy-result {
    min-width: 200px;
    max-width: 280px;
  }
}
</style>

Tasks as code.

A brainfile.md file in your repo. Structured YAML frontmatter that tools can parse. Human-readable markdown you can edit directly. It's data and documentation in one file.

``
---
title: My Project
columns:
  - id: todo
    tasks:
  - id: task-1
        title: Implement authentication
        priority: high
---
`

Git-native workflow.

Branch your tasks with your code. Merge them together. See task changes in your diff. Roll back if needed. Your task history is your git history.

AI-first integration.

The MCP server exposes your tasks as tools. AI assistants don't read a file — they call structured operations: list_tasks, add_task, move_task. Type-safe. Error-handled. No YAML corruption.

---

Comparison

| Feature | Brainfile | Linear/Jira | GitHub Issues | Notion |
|---------|-----------|-------------|---------------|--------|
| Lives in repo | ✅ | ❌ | ❌ | ❌ |
| Works offline | ✅ | ❌ | ❌ | ❌ |
| AI can update directly | ✅ MCP | ❌ | ❌ | ❌ |
| Version controlled | ✅ git | ❌ | Partial | ❌ |
| No account required | ✅ | ❌ | ❌ | ❌ |
| Free forever | ✅ | Freemium | Freemium | Freemium |
| Kanban UI | ✅ VSCode/TUI | ✅ | ❌ Projects | ✅ |
| Team collaboration | ✅ git | ✅ | ✅ | ✅ |

---

Who It's For

Developers Using AI Tools

You're already using Claude Code, Cursor, or Cline. You want your AI assistant to actually know what you're working on — not just your code, but your tasks. MCP integration means your assistant can list, create, and update tasks without you copy-pasting anything.

Solo Devs Who Want Simplicity

You don't need Jira. You don't want to pay for Linear. You just want a task list that lives in your project, works offline, and doesn't require another account. Open your terminal, run brainfile, and you have a kanban board.

Developers Tired of Freemium Tools

Every project management tool starts free, then slowly gates features behind pricing tiers. Brainfile is a file format — it's yours. No subscription. No "upgrade to unlock." No "your trial has ended."

Builders Who Want a Foundation

The @brainfile/core library gives you parsing, serialization, validation, and operations. Build a custom CLI. Create a web dashboard. Integrate with your existing tools. The protocol is stable; build whatever you want on top.

Anyone Who Wants Local-First Tasks

Maybe you're not a developer. Maybe you just want a personal task list that:
  - Lives on your machine, not in the cloud
  - Works without internet
  - Can be backed up by copying a file
  - Doesn't require creating yet another account

The TUI works great for personal task management too.

---

Maybe Not For
  - Large orgs with complex approval workflows
  - Teams needing enterprise reporting and analytics
  - Projects where non-technical stakeholders manage tasks
  - Situations requiring audit trails beyond git history

---

The Philosophy

> The protocol is the product.

Brainfile is a file format first, tools second. You can write brainfile.md` by hand with any text editor. The CLI, VSCode extension, and MCP server are conveniences built on top of a stable specification.

This means:
  - No vendor lock-in — It's just a markdown file
  - Ecosystem potential — Anyone can build tools
  - Future-proof — The format outlasts any single tool

---

Next Steps
  - Quick Start — Get running in 60 seconds
  - CLI Commands — Terminal interface
  - MCP Integration — AI assistant setup

---

## 3. Getting Started with Contracts

Getting Started with Contracts

Brainfile isn't just for human-to-human task management. Its most powerful feature is Agent Coordination: the ability for one AI assistant (acting as a PM) to assign structured work to another AI assistant (the worker).

What are Contracts?

A Contract is an optional set of rules attached to a task. It defines exactly what needs to be done, how it will be verified, and what constraints must be followed.

When an AI agent sees a task with a contract, it doesn't just "try its best"—it follows a formal lifecycle to ensure the work meets your specifications.

Why use them?
  - Reliability: Agents know exactly what deliverables are expected.
  - Automation: Validation commands can automatically check work before it's marked "Done".
  - Delegation: You (or your primary AI assistant) can delegate complex sub-tasks to other specialized agents with high confidence.

A Simple Example

Imagine you want an agent to create a new React component. Instead of a vague task, you create a contract:

``
id: task-101
title: "Create UserProfile component"
contract:
  status: ready
  deliverables:
  - type: file
      path: src/components/UserProfile.tsx
      description: Main component file
  - type: test
      path: src/components/UserProfile.test.tsx
  validation:
    commands:
  - npm test src/components/UserProfile.test.tsx
  constraints:
  - Use Tailwind CSS for styling
  - Must be a functional component
`

The Coordination Lifecycle
  Draft: The contract is being defined (usually by you or a PM agent).
  Ready: The task is ready for a worker agent to pick up.
  In Progress: A worker agent has started the work.
  Delivered: The worker has finished and is waiting for validation.
  Done: The work is validated and complete.

Try it now

You can add a contract to any task using the CLI:

`
brainfile add --title "Refactor Auth" \
  --with-contract \
  --deliverable "src/auth.ts" \
  --validation "npm test"
``

Next, learn about Complex Agent Workflows or see the full Contract Schema Reference.

---

## 4. Comprehensive Guide to Contracts

Agent-to-Agent Contracts

The Brainfile contract system provides a structured way for AI agents to coordinate work. It moves beyond simple task assignments by defining clear deliverables, implementation constraints, and validation procedures.

Core Principles
  Agent-First Design: Optimized for the unique needs of AI-to-AI coordination.
  Explicit Expectations: Contracts define exactly what must be produced (deliverables) and how it will be verified (validation).
  Autonomous Execution: Once a contract is picked up, the worker agent has the autonomy to complete the task within the defined constraints.
  Trust + Verify: PM agents validate the results against the contract before closing the task.
  Single Source of Truth: Contracts are embedded directly in the brainfile.md task, keeping context and status in one place.

The Contract Schema

A contract is an optional property of a task. When present, it formalizes the "handshake" between agents.

``
  - id: task-101
  title: Implement rate limiter
  description: |
    Implement token bucket rate limiting to prevent API quota exhaustion.
  assignee: codex
  relatedFiles:
  - src/api/middleware.ts
  contract:
    status: ready
    deliverables:
  - path: src/rateLimiter.ts
        description: Token bucket implementation
  - path: src/__tests__/rateLimiter.test.ts
        description: Unit tests
    validation:
      commands:
  - "npm test -- rateLimiter"
    constraints:
  - "Use token bucket algorithm"
  - "Must be non-blocking (async)"
`

Key Fields
  - status: The current state of the contract (ready, in_progress, delivered, done, failed, blocked).
  - deliverables: A list of specific files or artifacts the agent must produce.
  - validation.commands: Optional shell commands that the PM can run to automatically verify the work.
  - constraints: Guidelines or rules the agent must follow during implementation.
  - outOfScope: Explicitly defines what the agent should not do.
  - feedback: Used by the PM to provide guidance if a contract is rejected (status failed).

---

Contract Lifecycle

The lifecycle ensures that work is properly claimed, implemented, and verified.

`
graph LR
  ready(ready) --> pickup[pickup]
  pickup --> in_progress(in_progress)
  in_progress --> deliver[deliver]
  deliver --> delivered(delivered)
  delivered --> validate[validate / approve]
  validate --> done(done)
  delivered --> reject[reject]
  reject --> failed(failed)
  failed --> pickup
`

| State | Meaning | Next Action |
|-------|---------|-------------|
| ready | Contract is available for an agent to claim. | Agent: contract pickup |
| in_progress | Agent is currently working on the deliverables. | Agent: contract deliver |
| delivered | Work is complete and awaiting PM review. | PM: contract validate or approve |
| done | PM has verified and accepted the work. | PM: Move task to completion column. |
| failed | PM rejected the work. Feedback is provided. | Agent: Re-pickup for rework. |
| blocked | Agent is stuck and needs human/PM intervention. | PM: Resolve blocker and reset status. |

---

Working with Contracts

Creating Contracts

Contracts can be created alongside a task or attached to an existing one.

`

Create task with contract

brainfile add --with-contract --deliverable "src/auth.ts" --validation "npm test"

Attach contract to existing task

brainfile contract attach -t task-42 --deliverable "docs/api.md"
`

For Worker Agents

Worker agents follow a claim-implement-deliver workflow:
  List: Find assigned contracts with brainfile list --contract ready.
  Pickup: Claim the task with brainfile contract pickup -t task-X.
  Implement: Follow the instructions in description and contract.constraints.
  Self-Verify: Run validation.commands manually to ensure quality.
  Deliver: Submit the work with brainfile contract deliver -t task-X.

For PM Agents

PM agents (usually humans or advanced LLMs) manage the lifecycle:
  Define: Create tasks with clear contracts.
  Assign: Set the assignee to the appropriate worker agent.
  Validate: Once delivered, run brainfile contract validate -t task-X.
  Approval/Rejection: 
  - If successful: contract approve (if not auto-completed by validate).
  - If issues found: contract reject --feedback "...".

State Tracking

The contract system maintains internal state in .brainfile/state.json. This file is typically git-ignored and tracks:
  - Pickup version: Ensures agents don't work on stale versions of a contract.
  - Agent state: Tracks local progress that hasn't been delivered yet.

Metrics and Performance

The system automatically tracks metrics to help evaluate agent performance and task complexity:
  - Timestamps: Records when work was picked up, delivered, and validated.
  - Duration: Calculates the total time spent in the in_progress state.
  - Rework Count: Tracks how many times a contract was rejected and re-picked up.

These metrics are stored within the contract object in your brainfile.md`.

---

Benefits of the System
  - Reduces Ambiguity: "Done" is clearly defined by deliverables and validation commands.
  - Enables Parallelism: Multiple agents can work on different contracts simultaneously without overlapping.
  - Automated Verification: Integration tests can be part of the contract, ensuring that agents don't break existing functionality.
  - Traceability: Each state transition is tracked, providing a clear history of how a feature was implemented.

See the Agent Workflows Guide for practical patterns and CLI Reference for all available commands.

---

## 5. Agent Workflow Patterns

Agent Workflow Patterns

The contract system enables powerful coordination patterns between different types of agents. This guide outlines the standard roles and workflows for efficient project management.

Roles

PM Agent (Project Manager)

The PM agent is responsible for the "What" and "Why". They break down high-level goals into actionable tasks, define contracts, and verify results.
  - Primary tools: add, patch, contract attach, contract validate, contract approve, contract reject.
  - Key responsibility: Ensure task descriptions are comprehensive and validation criteria are objective.

Worker Agent (The Doer)

Worker agents (like codex, cursor, gemini) focus on the "How". They pick up contracts, implement code, and deliver artifacts.
  - Primary tools: list, contract pickup, contract deliver, show.
  - Key responsibility: Meet the deliverables and constraints defined in the contract.

---

The Standard Loop

A typical feature implementation follows this cycle:
  Planning (PM)

The PM agent analyzes the requirement and creates a task with a contract.

``
brainfile add --title "Add OAuth2 Support" \
  --description "Implement Google OAuth2 login flow. See design docs for details." \
  --assignee codex \
  --with-contract \
  --deliverable "src/auth/oauth.ts:Implementation" \
  --deliverable "src/auth/__tests__/oauth.test.ts:Tests" \
  --validation "npm test -- oauth" \
  --constraint "Use official google-auth-library"
`
  Execution (Worker)

The worker agent detects the assignment and begins work.

`

Worker checks for new tasks

brainfile list --contract ready --assignee codex

Worker claims the task

brainfile contract pickup -t task-105

Worker reads full details

brainfile show -t task-105

Worker implements code...

Worker self-verifies

npm test -- oauth

Worker delivers

brainfile contract deliver -t task-105
`
  Verification (PM)

The PM agent reviews the work and closes the task.

`

PM sees delivered tasks

brainfile list --contract delivered

PM runs automated validation

brainfile contract validate -t task-105

If all good, PM moves task to Done

brainfile move -t task-105 -c Done
`

---

Handling Rework

If the PM agent finds issues during validation or manual review, the rework flow is triggered.
  PM Rejects: brainfile contract reject -t task-105 --feedback "Tests are passing, but the redirect URL is hardcoded. It should use the config."
  State Change: Contract status returns to failed.
  Worker Re-pickup: The worker sees the failed status, reads the feedback field via brainfile show, and runs contract pickup again.
  Fix & Re-deliver: Worker fixes the issue and runs contract deliver.

---

Blocked Agents

Sometimes a worker agent cannot proceed due to external factors (missing API keys, ambiguous requirements, upstream bugs).
  Agent Marks Blocked: brainfile contract blocked -t task-105 --reason "Need Google Client ID and Secret to complete tests."
  PM Notification: The PM sees the blocked status in the TUI or via list.
  Resolution: The PM provides the missing info or fixes the dependency.
  Reset: The PM runs brainfile contract reset -t task-105 to return it to ready or in_progress.

---

Advanced Patterns

The Multi-Agent Pipeline

Break a large feature into a sequence of contracts:
  Agent A (Architect): Produces an interface specification (docs/api.md).
  Agent B (Backend): Implements the API based on the spec.
  Agent C (Frontend): Consumes the API based on the spec.

Automated Triage

A specialized triage agent can monitor incoming bug reports (tasks without contracts), research the cause, and then attach a contract with specific relatedFiles and validation commands for a codex agent to fix.

Self-Referential Tasks

When implementing new Brainfile features, agents often use the system to build the system. For example, task-58 was used to implement the very contract creation commands you are using now.

``

---

## 6. CLI & Terminal UI

CLI & Terminal UI

The Brainfile CLI gives you full control over your task board from the terminal. Use the interactive TUI for a visual experience, or run commands for automation.

Installation

``
npm install -g @brainfile/cli
`

Verify installation:

`
brainfile --version
`

Core Features
  - Interactive TUI: A full-featured terminal kanban board.
  - Agent Coordination: Built-in support for Agent Contracts to coordinate work between AI assistants.
  - Rich Task Metadata: Support for priorities, tags, assignees, due dates, and subtasks.
  - Multi-Destination Archive: Move completed tasks to GitHub Issues or Linear.

---

Interactive TUI

Launch an interactive kanban board in your terminal:

`
brainfile
`

Or open a specific file:

`
brainfile ./path/to/brainfile.md
`

Keyboard Controls

| Key | Action |
|-----|--------|
| TAB / Shift+TAB | Navigate between columns |
| j / k or ↑ / ↓ | Navigate tasks |
| Enter | Expand/collapse task details |
| / | Search tasks |
| ? | Show help |
| r | Refresh |
| q | Quit |

::: info Real-time sync
The TUI watches your file for changes — edits from VSCode or AI assistants appear instantly.
:::

---

Common Commands

Initialize a New Board

`
brainfile init
`

Creates a brainfile.md with default structure: three columns (To Do, In Progress, Done) and agent instructions.

List Tasks

`
brainfile list                    # All tasks
brainfile list --column todo      # Filter by column
brainfile list --tag bug          # Filter by tag
`

Add Tasks

`
brainfile add --title "Implement auth"
brainfile add --title "Fix bug" --priority high --tags "bug,urgent"
brainfile add --title "Review PR" --assignee john --due-date 2025-02-01
`

Move Tasks

`
brainfile move --task task-1 --column in-progress
brainfile move --task task-1 --column done
`

Update Tasks

`
brainfile patch --task task-1 --priority critical
brainfile patch --task task-1 --title "New title" --tags "new,tags"
brainfile patch --task task-1 --clear-assignee  # Remove assignee
`

Manage Subtasks

`
brainfile subtask --task task-1 --add "Write tests"
brainfile subtask --task task-1 --toggle task-1-1
brainfile subtask --task task-1 --delete task-1-2
`

---

Agent Contracts

The CLI facilitates structured coordination between agents through the contract system.

Create Task with Contract

`
brainfile add --title "Implement API" \
  --with-contract \
  --deliverable "src/api.ts" \
  --validation "npm test"
`

Worker Agent Lifecycle
  Pickup: brainfile contract pickup -t task-1
  Deliver: brainfile contract deliver -t task-1

PM Agent Lifecycle
  Validate: brainfile contract validate -t task-1 (Auto)
  Approve: brainfile contract approve -t task-1 (Manual)
  Reject: brainfile contract reject -t task-1 --feedback "..."

See the Agent Contracts Guide for more details.

---

Archive & Restore

`

Local archive

brainfile archive --task task-5

Archive to GitHub Issues (creates closed issue)

brainfile archive --task task-5 --to=github

Archive to Linear (creates completed issue)

brainfile archive --task task-5 --to=linear

Restore from archive

brainfile restore --task task-5 --column todo
`

Authentication

Archive to external services requires authentication:

`

GitHub (auto-detects gh CLI, or uses OAuth device flow)

brainfile auth github

Linear (requires API key)

brainfile auth linear --token <api-key>

Check status

brainfile auth status
`

Configuration

`

Set default archive destination

brainfile config set archive.default github
brainfile config set archive.github.owner myorg
brainfile config set archive.github.repo myrepo
`

Validate

`
brainfile lint              # Check for issues
brainfile lint --fix        # Auto-fix issues
brainfile lint --check      # Exit with error code (for CI)
`

---

Templates

Create tasks from built-in templates:

`
brainfile template --list
brainfile template --use bug-report --title "Login fails on mobile"
brainfile template --use feature-request --title "Add dark mode"
`

Available templates:
  - bug-report — Bug tracking with triage subtasks
  - feature-request — Feature proposals
  - refactor — Code refactoring tasks

---

Shell Aliases

::: tip Speed up your workflow
Add these to your .bashrc or .zshrc:
:::

`
alias bf="brainfile"
alias bfl="brainfile list"
alias bfa="brainfile add"
alias bfm="brainfile move"
``

---

Next Steps
  - Full Command Reference — All options and flags
  - MCP Server — AI assistant integration
  - CI/CD Examples — Automation workflows

---

## 7. MCP Server Integration

MCP Server

The Brainfile CLI includes a built-in MCP (Model Context Protocol) server. This lets AI assistants like Claude Code, Cursor, and Cline manage your tasks directly — no copy-paste, no manual updates.

Why MCP?

Without MCP, your AI assistant can read your code but doesn't know what you're working on. You have to:
  - Explain the current task every conversation
  - Copy task descriptions into prompts
  - Manually update task status after work is done

With MCP, your assistant:
  - Sees all your tasks and their status
  - Creates new tasks as work is identified
  - Moves tasks to "done" when complete
  - Updates priorities and metadata automatically

It's the difference between "update my task board" and just having it happen.

---

Setup

Add to .mcp.json in your project root:

``
{
  "mcpServers": {
    "brainfile": {
      "command": "npx",
      "args": ["@brainfile/cli", "mcp"]
    }
  }
}
`

For a specific brainfile path:

`
{
  "mcpServers": {
    "brainfile": {
      "command": "npx",
      "args": ["@brainfile/cli", "mcp", "-f", "path/to/brainfile.md"]
    }
  }
}
`

::: warning
Restart your AI assistant after adding or changing MCP configuration.
:::

---

Available Tools

Your AI assistant gets access to these operations:

Task Management

| Tool | Description |
|------|-------------|
| list_tasks | List all tasks, filter by column or tag |
| add_task | Create a task with title, priority, tags, etc. |
| move_task | Move a task between columns |
| patch_task | Update specific fields on a task |
| delete_task | Permanently delete a task |

Archiving

| Tool | Description |
|------|-------------|
| archive_task | Archive a task locally or to GitHub/Linear |
| restore_task | Restore an archived task to a column |

The archive_task tool supports an optional destination parameter:
  - "local" — Move to local archive section (default)
  - "github" — Create a closed GitHub Issue
  - "linear" — Create a completed Linear issue

If not specified, uses your project default (archive.destination in brainfile.md) or user default (~/.config/brainfile/config.json).

::: tip External Archive Setup
To archive to GitHub or Linear, first authenticate:
`
npx @brainfile/cli auth github
npx @brainfile/cli auth linear --token <api-key>
`
Then configure your repository:
`
npx @brainfile/cli config set archive.github.owner myorg
npx @brainfile/cli config set archive.github.repo myrepo
`
:::

Subtasks

| Tool | Description |
|------|-------------|
| add_subtask | Add a subtask to a task |
| toggle_subtask | Mark a subtask complete/incomplete |
| update_subtask | Change a subtask's title |
| delete_subtask | Remove a subtask |

---

Example Interactions

You: "What tasks do I have in progress?"

Assistant: calls list_tasks with column filter "You have 2 tasks in progress: task-3 'Fix auth bug' and task-7 'Update documentation'."

---

You: "I finished the auth bug fix"

Assistant: calls move_task "I've moved task-3 to Done."

---

You: "Create a task for the performance issue we discussed"

Assistant: calls add_task "Created task-12 'Investigate slow dashboard load' with high priority in To Do."

---

Benefits Over Manual Updates

| Aspect | Manual | MCP |
|--------|--------|-----|
| Context switching | Open board, find task, update | Zero |
| Error risk | YAML typos possible | Type-safe operations |
| Consistency | Varies by attention | Always correct format |
| Speed | 30+ seconds | Instant |

---

Supported Assistants

The MCP server works with any tool that supports the Model Context Protocol:
  - Claude Code — Full support
  - Cursor — Full support
  - Cline — Full support
  - Other MCP clients — Should work, untested

---

Troubleshooting

Server not loading
  Check that @brainfile/cli is installed: npx @brainfile/cli --version
  Verify .mcp.json is valid JSON
  Restart your AI assistant completely
  Check assistant logs for MCP errors

Tools not appearing

Some assistants cache tool lists. Try:
  Restart the assistant
  Start a new conversation
  Explicitly ask "what brainfile tools do you have?"

Wrong file being used

Specify the file explicitly:
`
"args": ["@brainfile/cli", "mcp", "-f", "./my-project/brainfile.md"]
`

---

Manual Testing

Run the MCP server directly to test:

`
brainfile mcp
brainfile mcp --file ./project/brainfile.md
`

The server communicates via stdio — you'll see JSON-RPC messages if tools are called.

---

Alternative: Agent Hooks

::: tip No MCP support?
If your assistant doesn't support MCP, you can install hooks that remind you to update tasks:
:::

`
brainfile hooks install claude-code
brainfile hooks install cursor --scope project
brainfile hooks install cline
``

Hooks provide gentle reminders but don't give the assistant direct control.

---

Next Steps
  - CLI Commands — Manual task management
  - Protocol Specification — File format details
  - Core Library — Programmatic access

---

## 8. VSCode Extension

VSCode Extension

The Brainfile extension brings a visual kanban board directly into VSCode. See your tasks in the sidebar, drag and drop between columns, and stay in your editor.

Installation
  Open VSCode
  Go to Extensions (Cmd+Shift+X / Ctrl+Shift+X)
  Search for "Brainfile"
  Click Install

Or install from the command line:

``
code --install-extension brainfile.brainfile
`

Features

Kanban Board View

The extension adds a Brainfile panel to your sidebar. Open any project with a brainfile.md file and the board appears automatically.
  - Columns — Your workflow stages (To Do, In Progress, Done)
  - Tasks — Cards showing title, priority, tags
  - Drag & Drop — Move tasks between columns visually

Real-time Sync

::: info All tools stay in sync
The extension watches your brainfile.md for changes. Edits from the CLI, AI assistants, or direct file changes appear instantly. No refresh needed.
:::

Task Details

Click a task to see:
  - Full description
  - Subtasks with completion status
  - Assignee and due date
  - Related files
  - Tags and priority

Quick Actions
  - Add Task — Click + in any column
  - Edit Task — Click the edit icon
  - Delete Task — Right-click menu
  - Move Task — Drag between columns

---

File Discovery

The extension looks for brainfile in this order:
  brainfile.md (preferred)
  .brainfile.md (hidden, backward compat)

If found, the kanban view activates automatically.

---

Keyboard Shortcuts

| Shortcut | Action |
|----------|--------|
| Cmd+Shift+B | Toggle Brainfile panel |
| Cmd+Shift+N | New task in current column |

---

Settings

Configure via VSCode settings (Cmd+,):

`
{
  "brainfile.defaultFile": "brainfile.md",
  "brainfile.showInActivityBar": true
}
`

---

Troubleshooting

Board not showing
  Ensure brainfile.md exists in your workspace root
  Check the file is valid YAML (run brainfile lint)
  Reload the window (Cmd+Shift+P → "Reload Window")

Changes not syncing

The extension uses file watching. If changes aren't appearing:
  Save the file explicitly
  Check VSCode's file watcher isn't rate-limited
  Reload the window

Invalid YAML errors

::: tip Quick fix
Run brainfile lint --fix to auto-fix common issues like unquoted strings with colons.
:::

---

Works With

The VSCode extension complements other Brainfile tools:
  - CLI — Use both interchangeably
  - MCP Server — AI updates appear in real-time
  - TUI — Terminal users see the same data

All tools read the same brainfile.md` file.

---

Source Code

The extension is open source:
  - GitHub Repository
  - Issue Tracker

---

Next Steps
  - CLI & TUI — Command-line interface
  - MCP Server — AI integration
  - Quick Start — Getting started guide

---

## 9. Core Library

Core Library

@brainfile/core is the TypeScript library that powers all Brainfile tools. Use it to build custom integrations, scripts, or entirely new interfaces.

Installation

``
npm install @brainfile/core
`

Quick Example

`
import { Brainfile, addTask, moveTask } from '@brainfile/core';
import fs from 'fs';

// Parse a brainfile
const markdown = fs.readFileSync('brainfile.md', 'utf-8');
let board = Brainfile.parse(markdown);

// Add a task (immutable - returns new board)
const result = addTask(board, 'todo', {
  title: 'New feature',
  priority: 'high',
  tags: ['feature']
});

if (result.success) {
  board = result.board!;
}

// Move a task
const moveResult = moveTask(board, 'task-1', 'todo', 'in-progress', 0);
if (moveResult.success) {
  board = moveResult.board!;
}

// Save changes
const output = Brainfile.serialize(board);
fs.writeFileSync('brainfile.md', output);
`

---

Core Concepts

Immutable Operations

::: info Key concept
All operations are immutable — they return a new board object rather than modifying the original.
:::

`
const result = addTask(board, 'todo', { title: 'Task' });

// Original unchanged
console.log(board.columns[0].tasks.length);  // 0

// New board has the task
console.log(result.board!.columns[0].tasks.length);  // 1
`

Operation Results

Every operation returns a BoardOperationResult:

`
interface BoardOperationResult {
  success: boolean;
  board?: Board;   // New board if successful
  error?: string;  // Error message if failed
}
`

Always check success before using the result:

`
const result = moveTask(board, 'task-999', 'todo', 'done', 0);
if (!result.success) {
  console.error(result.error);  // "Task not found: task-999"
}
`

---

Board Operations

Add Task

`
import { addTask, TaskInput } from '@brainfile/core';

const input: TaskInput = {
  title: 'Implement auth',
  description: 'Add OAuth2 support',
  priority: 'high',
  tags: ['security', 'feature'],
  assignee: 'john',
  dueDate: '2025-02-01',
  subtasks: ['Research', 'Implement', 'Test']  // Creates subtasks
};

const result = addTask(board, 'todo', input);
`

Patch Task

::: tip Removing fields
Set a field to null to remove it from the task.
:::

`
import { patchTask, TaskPatch } from '@brainfile/core';

// Update fields
const result = patchTask(board, 'task-1', {
  priority: 'critical',
  tags: ['urgent']
});

// Remove fields
const removeResult = patchTask(board, 'task-1', {
  assignee: null,  // Removes assignee
  dueDate: null    // Removes due date
});
`

Move Task

`
import { moveTask } from '@brainfile/core';

// Move task-1 from todo to in-progress, at position 0
const result = moveTask(board, 'task-1', 'todo', 'in-progress', 0);
`

Delete Task

`
import { deleteTask } from '@brainfile/core';

const result = deleteTask(board, 'todo', 'task-1');
`

Archive & Restore

`
import { archiveTask, restoreTask } from '@brainfile/core';

// Archive
const archiveResult = archiveTask(board, 'done', 'task-5');

// Restore to a column
const restoreResult = restoreTask(board, 'task-5', 'todo');
`

---

Subtask Operations

`
import {
  addSubtask,
  toggleSubtask,
  updateSubtask,
  deleteSubtask
} from '@brainfile/core';

// Add subtask (ID auto-generated)
const addResult = addSubtask(board, 'task-1', 'Write tests');

// Toggle completion
const toggleResult = toggleSubtask(board, 'task-1', 'task-1-1');

// Update title
const updateResult = updateSubtask(board, 'task-1', 'task-1-1', 'New title');

// Delete
const deleteResult = deleteSubtask(board, 'task-1', 'task-1-2');
`

---

Parsing & Serialization

Parse

`
import { Brainfile, BrainfileParser } from '@brainfile/core';

// Simple parse
const board = Brainfile.parse(markdown);

// Parse with error details
const result = BrainfileParser.parseWithErrors(markdown);
if (!result.board) {
  console.error('Parse error:', result.error);
}
if (result.warnings) {
  console.warn('Warnings:', result.warnings);
}
`

Serialize

`
import { Brainfile, BrainfileSerializer } from '@brainfile/core';

// Simple serialize
const output = Brainfile.serialize(board);

// With options
const output = BrainfileSerializer.serialize(board, {
  indent: 2,
  lineWidth: 80,
  trailingNewline: true
});
`

---

Validation & Linting

`
import { Brainfile, BrainfileLinter } from '@brainfile/core';

// Validate structure
const validation = Brainfile.validate(board);
if (!validation.valid) {
  validation.errors.forEach(e => console.log(${e.path}: ${e.message}));
}

// Lint raw content
const lintResult = Brainfile.lint(content);
console.log(lintResult.issues);

// Lint with auto-fix
const fixedResult = Brainfile.lint(content, { autoFix: true });
console.log(fixedResult.fixedContent);
`

---

Templates

`
import { Brainfile } from '@brainfile/core';

// List templates
const templates = Brainfile.getBuiltInTemplates();

// Create from template
const task = Brainfile.createFromTemplate('bug-report', {
  title: 'Login fails on mobile',
  description: 'Users see error on iOS Safari'
});
`

---

Realtime Sync Utilities

For building UIs with live updates:

`
import { hashBoardContent, hashBoard, diffBoards } from '@brainfile/core';

// Hash content to detect changes
const hash = hashBoardContent(markdown);
if (hash !== lastHash) {
  // Content changed, re-parse
}

// Diff boards for incremental updates
const diff = diffBoards(oldBoard, newBoard);
if (diff.tasksMoved.length > 0) {
  // Handle moved tasks
}
`

---

TypeScript Types

`
import type {
  Board,
  Column,
  Task,
  Subtask,
  TaskInput,
  TaskPatch,
  BoardOperationResult
} from '@brainfile/core';
``

See API Reference for complete type definitions.

---

Next Steps
  - API Reference — Complete method documentation
  - Protocol Specification — File format details
  - CLI Source — See how CLI uses core

---

## 10. Protocol Specification

Protocol Specification

The Brainfile protocol defines a structured format for project tasks stored in markdown files with YAML frontmatter.

File Format

Primary File

| Filename | Priority | Notes |
|----------|----------|-------|
| brainfile.md | 1 (preferred) | Non-hidden, visible in file browsers |
| .brainfile.md | 2 | Hidden, backward compatibility |

Archive File

Completed tasks can be moved to brainfile-archive.md.

---

YAML Structure

Minimal Valid File

``
---
title: My Project
columns:
  - id: todo
    title: To Do
    tasks: []
---
`

Complete Structure

`
---
title: string              # Required: Project title
type: board                # Optional: defaults to board
schema: string             # Optional: URL or path to JSON schema
protocolVersion: string    # Optional: e.g., "1.0.0"

agent:                     # Optional: AI agent instructions
  instructions:
  - string
  llmNotes: string

rules:                     # Optional: Project rules
  always:
  - id: number
      rule: string
  never: []
  prefer: []
  context: []

columns:                   # Required: Array of columns
  - id: string             # Unique kebab-case identifier
    title: string          # Display title
    tasks:                 # Array of tasks
  - id: string         # Pattern: task-N
        title: string      # Required
        description: string
        priority: string   # low|medium|high|critical
        effort: string     # trivial|small|medium|large|xlarge
        assignee: string
        dueDate: string    # ISO 8601 (YYYY-MM-DD)
        tags: []
        relatedFiles: []
        blockedBy: []      # Array of task IDs
        subtasks:
  - id: string     # Pattern: task-N-M
            title: string
            completed: boolean

archive: []                # Optional: Archived tasks
---
`

---

Field Reference

Board Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| title | string | Yes | Project or board title |
| type | string | No | Document type (default: board) |
| schema | string | No | JSON schema URL for validation |
| protocolVersion | string | No | Protocol version |
| agent | object | No | AI agent instructions |
| rules | object | No | Project rules |
| columns | array | Yes | Workflow columns |
| archive | array | No | Archived tasks |

Column Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| id | string | Yes | Unique identifier (kebab-case) |
| title | string | Yes | Display title |
| tasks | array | Yes | Tasks in this column |

Task Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| id | string | Yes | Unique ID (pattern: task-N) |
| title | string | Yes | Task title |
| description | string | No | Detailed description (markdown) |
| priority | string | No | low, medium, high, critical |
| effort | string | No | trivial, small, medium, large, xlarge |
| assignee | string | No | Person responsible |
| dueDate | string | No | ISO 8601 date |
| tags | array | No | String tags for filtering |
| relatedFiles | array | No | File paths |
| blockedBy | array | No | Task IDs that block this task |
| subtasks | array | No | Subtask objects |
| template | string | No | bug, feature, refactor |

Subtask Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| id | string | Yes | Unique ID (pattern: task-N-M) |
| title | string | Yes | Subtask title |
| completed | boolean | Yes | Completion status |

---

Standard Column IDs

These IDs are conventional but not required:

| ID | Purpose |
|----|---------|
| backlog | Tasks not yet scheduled |
| todo | Tasks to be started |
| in-progress | Tasks being worked on |
| review | Tasks pending review |
| done | Completed tasks |

---

Agent Instructions

The agent block guides AI assistant behavior:

`
agent:
  instructions:
  - Modify only the YAML frontmatter
  - Preserve all IDs
  - Keep ordering
  - Make minimal changes
  - Preserve unknown fields
  llmNotes: "Prefer functional patterns and comprehensive tests"
`

| Instruction | Reason |
|-------------|--------|
| Modify only YAML frontmatter | Content after --- is user documentation |
| Preserve all IDs | Changing IDs breaks references |
| Keep ordering | Maintains visual consistency |
| Make minimal changes | Reduces merge conflicts |
| Preserve unknown fields | Future-proofs against extensions |

---

Rules Block

Project rules for AI and human reference:

`
rules:
  always:
  - id: 1
      rule: write tests for new features
  - id: 2
      rule: update task status as you work
  never:
  - id: 1
      rule: commit directly to main
  prefer:
  - id: 1
      rule: functional patterns over classes
  context:
  - id: 1
      rule: TypeScript monorepo with Jest
`

---

Schema Reference

Official Schemas

| Type | URL |
|------|-----|
| Base | https://brainfile.md/v1/base.json |
| Board | https://brainfile.md/v1/board.json |

Browse all: brainfile.md/v1/

Type Inference

When type is omitted, tools detect by:
  Schema URL pattern (/v1/board.json → board)
  Structural analysis (columns[] → board)
  Default: board

---

ID Patterns

Task IDs

Pattern: task-N where N is a sequential number.

`
  - id: task-1
  - id: task-2
  - id: task-15
`

Subtask IDs

Pattern: task-N-M where N is parent task number, M is subtask number.

`
subtasks:
  - id: task-1-1
  - id: task-1-2
`

---

Version History

v1.0.0 (Current)
  - Stable release: board-only task management
  - Simplified protocol focus
  - Full MCP tool support

v0.5.0
  - Added base schema with inheritance
  - Added agent.tools for CLI tool configuration

v0.4.0
  - Added protocolVersion field
  - Added effort and blockedBy task fields
  - Added llmNotes to agent block

v0.3.0
  - Changed default to non-hidden files (brainfile.md)
  - Added agent instruction block
  - Added subtasks support

---

Best Practices
  Use non-hidden files — Better visibility, AI-friendly
  Include agent instructions — Consistent AI behavior
  Preserve IDs — Never regenerate or change task IDs
  Use semantic IDs — Sequential task-1, task-2
  Keep descriptions concise — But informative
  Archive completed tasks — Keep board clean

---

Example

`
---
title: My Project
type: board
schema: https://brainfile.md/v1/board.json
agent:
  instructions:
  - Modify only the YAML frontmatter
  - Preserve all IDs
columns:
  - id: todo
    title: To Do
    tasks:
  - id: task-1
        title: Implement user authentication
        description: Add OAuth2 support for Google and GitHub
        priority: high
        effort: large
        tags: [backend, security]
        subtasks:
  - id: task-1-1
            title: Setup OAuth provider
            completed: false
  - id: task-1-2
            title: Create login UI
            completed: false
  - id: in-progress
    title: In Progress
    tasks: []
  - id: done
    title: Done
    tasks: []
---

My Project

Project documentation can go here. This content is preserved
but not parsed by tools.
``

---

Next Steps
  - API Reference — Library method documentation
  - CLI Commands — Full command reference
  - Schema Types — Document type schemas

---

## 11. API Reference

API Reference

Complete documentation for @brainfile/core TypeScript library.

Brainfile Class

The main class provides static methods for all core operations.

Parsing

Brainfile.parse(content: string): Board | null

Parse markdown content into a Board object.

``
const board = Brainfile.parse(markdownString);
if (board) {
  console.log(board.title);
}
`

Brainfile.parseWithErrors(content: string): ParseResult

Parse with detailed error and warning information.

`
const result = Brainfile.parseWithErrors(markdownString);
if (result.board) {
  console.log("Parsed successfully");
  if (result.warnings) {
    console.warn("Warnings:", result.warnings);
  }
} else {
  console.error("Parse error:", result.error);
}
`

Serialization

Brainfile.serialize(board: Board, options?: SerializeOptions): string

Serialize a Board object back to markdown format.

`
const markdown = Brainfile.serialize(board, {
  indent: 2,
  lineWidth: 80,
  trailingNewline: true,
});
`

Validation

Brainfile.validate(board: Board): ValidationResult

Validate a board against the schema.

`
const validation = Brainfile.validate(board);
if (!validation.valid) {
  validation.errors.forEach((err) => {
    console.log(${err.path}: ${err.message});
  });
}
`

Linting

Brainfile.lint(content: string, options?: LintOptions): LintResult

Lint raw content for issues, optionally auto-fixing.

`
// Check for issues
const result = Brainfile.lint(content);
console.log(result.issues);

// Auto-fix issues
const fixedResult = Brainfile.lint(content, { autoFix: true });
console.log(fixedResult.fixedContent);
`

Templates

Brainfile.getBuiltInTemplates(): TaskTemplate[]

Get all built-in task templates.

`
const templates = Brainfile.getBuiltInTemplates();
templates.forEach((t) => console.log(${t.id}: ${t.name}));
`

Brainfile.getTemplate(id: string): TaskTemplate | undefined

Get a specific template by ID.

Brainfile.createFromTemplate(templateId: string, values: Record<string, string>): Partial<Task>

Create a task from a template.

`
const task = Brainfile.createFromTemplate("bug-report", {
  title: "Login fails on mobile",
  description: "Users cannot log in on iOS",
});
`

Location Finding

Brainfile.findTaskLocation(content: string, taskId: string): Location

Find line number of a task in source.

Brainfile.findRuleLocation(content: string, ruleId: number, ruleType: RuleType): Location

Find line number of a rule in source.

---

Board Operations

All operations are immutable and return BoardOperationResult.

addTask(board, columnId, input): BoardOperationResult

`
import { addTask, type TaskInput } from "@brainfile/core";

const result = addTask(board, "todo", {
  title: "Implement auth",
  description: "Add OAuth2 support",
  priority: "high",
  tags: ["security"],
  assignee: "john",
  dueDate: "2025-02-01",
  subtasks: ["Research", "Implement", "Test"],
});

if (result.success) {
  board = result.board!;
}
`

patchTask(board, taskId, patch): BoardOperationResult

Set fields to null to remove them.

`
import { patchTask } from "@brainfile/core";

// Update fields
patchTask(board, "task-1", { priority: "critical" });

// Remove fields
patchTask(board, "task-1", { assignee: null, dueDate: null });
`

moveTask(board, taskId, fromColumn, toColumn, toIndex): BoardOperationResult

`
import { moveTask } from "@brainfile/core";

moveTask(board, "task-1", "todo", "in-progress", 0);
`

deleteTask(board, columnId, taskId): BoardOperationResult

`
import { deleteTask } from "@brainfile/core";

deleteTask(board, "todo", "task-1");
`

archiveTask(board, columnId, taskId): BoardOperationResult

`
import { archiveTask } from "@brainfile/core";

archiveTask(board, "done", "task-5");
`

restoreTask(board, taskId, columnId): BoardOperationResult

`
import { restoreTask } from "@brainfile/core";

restoreTask(board, "task-5", "todo");
`

---

Subtask Operations

addSubtask(board, taskId, title): BoardOperationResult

ID is auto-generated as task-N-M.

deleteSubtask(board, taskId, subtaskId): BoardOperationResult

updateSubtask(board, taskId, subtaskId, title): BoardOperationResult

toggleSubtask(board, taskId, subtaskId): BoardOperationResult

`
import {
  addSubtask,
  deleteSubtask,
  updateSubtask,
  toggleSubtask,
} from "@brainfile/core";

addSubtask(board, "task-1", "New subtask");
toggleSubtask(board, "task-1", "task-1-1");
updateSubtask(board, "task-1", "task-1-1", "Updated title");
deleteSubtask(board, "task-1", "task-1-2");
`

---

Realtime Sync Utilities

hashBoardContent(content: string): string

SHA-256 hash of raw content. Use to detect file changes.

`
const hash = hashBoardContent(markdown);
if (hash !== lastHash) {
  refreshBoard();
}
`

hashBoard(board: Board): string

Hash of serialized board. Deterministic fingerprint for sharing.

diffBoards(previous: Board, next: Board): BoardDiff

Compute structural differences for incremental UI updates.

`
const diff = diffBoards(oldBoard, newBoard);
if (diff.tasksMoved.length > 0) {
  // Handle moved tasks
}
`

---

Types

Board

`
interface Board {
  title: string;
  protocolVersion?: string;
  schema?: string;
  agent?: AgentInstructions;
  rules?: Rules;
  columns: Column[];
  archive?: Task[];
}
`

Column

`
interface Column {
  id: string;
  title: string;
  tasks: Task[];
}
`

Task

`
interface Task {
  id: string;
  title: string;
  description?: string;
  relatedFiles?: string[];
  assignee?: string;
  tags?: string[];
  priority?: "low" | "medium" | "high" | "critical";
  effort?: "trivial" | "small" | "medium" | "large" | "xlarge";
  blockedBy?: string[];
  dueDate?: string;
  subtasks?: Subtask[];
  template?: "bug" | "feature" | "refactor";
}
`

Subtask

`
interface Subtask {
  id: string;
  title: string;
  completed: boolean;
}
`

TaskInput

For addTask():

`
interface TaskInput {
  title: string;
  description?: string;
  priority?: "low" | "medium" | "high" | "critical";
  tags?: string[];
  assignee?: string;
  dueDate?: string;
  relatedFiles?: string[];
  template?: "bug" | "feature" | "refactor";
  subtasks?: string[]; // Titles only, IDs auto-generated
}
`

TaskPatch

For patchTask(). Use null to remove fields.

`
interface TaskPatch {
  title?: string;
  description?: string | null;
  priority?: "low" | "medium" | "high" | "critical" | null;
  tags?: string[] | null;
  assignee?: string | null;
  dueDate?: string | null;
  relatedFiles?: string[] | null;
  template?: "bug" | "feature" | "refactor" | null;
}
`

BoardOperationResult

`
interface BoardOperationResult {
  success: boolean;
  board?: Board;  // New board if success
  error?: string; // Error message if failed
}
`

BoardDiff

`
interface BoardDiff {
  metadataChanged: boolean;
  columnsAdded: ColumnDiff[];
  columnsRemoved: ColumnDiff[];
  columnsUpdated: ColumnDiff[];
  columnsMoved: ColumnDiff[];
  tasksAdded: TaskDiff[];
  tasksRemoved: TaskDiff[];
  tasksUpdated: TaskDiff[];
  tasksMoved: TaskDiff[];
}
`

AgentInstructions

`
interface AgentInstructions {
  instructions?: string[];
  llmNotes?: string;
}
`

Rules

`
interface Rules {
  always?: Rule[];
  never?: Rule[];
  prefer?: Rule[];
  context?: Rule[];
}

interface Rule {
  id: number;
  rule: string;
}
`

SerializeOptions

`
interface SerializeOptions {
  indent?: number;        // Default: 2
  lineWidth?: number;     // Default: 80
  trailingNewline?: boolean; // Default: true
}
`

ValidationResult

`
interface ValidationResult {
  valid: boolean;
  errors: ValidationError[];
}

interface ValidationError {
  path: string;
  message: string;
}
`

ParseResult

`
interface ParseResult {
  board: Board | null;
  error?: string;
  warnings?: string[];
}
`

---

Low-Level Classes

For advanced usage:

`
import {
  BrainfileParser,
  BrainfileSerializer,
  BrainfileValidator,
  BrainfileLinter,
} from "@brainfile/core";

// Parser
BrainfileParser.parse(markdown);
BrainfileParser.parseWithErrors(markdown);
BrainfileParser.findTaskLocation(markdown, "task-1");

// Serializer
BrainfileSerializer.serialize(board, options);

// Validator
BrainfileValidator.validate(board);

// Linter
BrainfileLinter.lint(content, { autoFix: true });
BrainfileLinter.getSummary(lintResult);
BrainfileLinter.groupIssues(lintResult);
``

---

Next Steps
  - Protocol Specification — File format details
  - CLI Commands — Command-line interface
  - Core Library Guide — Usage examples

---

## 12. CLI Commands Reference

CLI Command Reference

Complete documentation for all @brainfile/cli commands.

Command Overview

``
brainfile [file]        # Open TUI (default: brainfile.md)
brainfile <command>     # Run CLI command
brainfile mcp           # Start MCP server for AI assistants
`

Commands

| Command | Description |
|---------|-------------|
| init | Create a new brainfile |
| list | Display tasks |
| add | Create a new task |
| move | Move task between columns |
| patch | Update task fields |
| delete | Permanently delete a task |
| archive | Archive a task |
| restore | Restore from archive |
| subtask | Manage subtasks |
| lint | Validate and fix syntax |
| template | Create from templates |
| tui | Interactive terminal UI |
| hooks | AI agent hook integration |
| contract | Manage agent-to-agent contracts |
| mcp | MCP server for AI assistants |

---

init

Create a new brainfile in your project.

`
brainfile init
brainfile init --file ./tasks.md
brainfile init --force  # Overwrite existing
`

Options:
| Option | Description |
|--------|-------------|
| -f, --file <path> | Output path (default: brainfile.md) |
| --force | Overwrite if file exists |

---

list

Display all tasks with optional filtering.

`
brainfile list
brainfile list --column "In Progress"
brainfile list --tag bug
`

Options:
| Option | Description |
|--------|-------------|
| -f, --file <path> | Path to brainfile (default: brainfile.md) |
| -c, --column <name> | Filter by column |
| -t, --tag <name> | Filter by tag |

---

add

Create a new task with all available fields.

`
brainfile add --title "Implement auth"
brainfile add --title "Fix bug" --priority high --tags "bug,urgent"
brainfile add --title "Review PR" --assignee john --due-date 2025-02-01
`

Options:
| Option | Description |
|--------|-------------|
| -t, --title <text> | Task title (required) |
| -c, --column <name> | Target column (default: todo) |
| -d, --description <text> | Task description |
| -p, --priority <level> | low, medium, high, or critical |
| --tags <list> | Comma-separated tags |
| --assignee <name> | Assignee name |
| --due-date <date> | Due date (YYYY-MM-DD) |
| --subtasks <list> | Comma-separated subtask titles |
| --with-contract | Initialize with an empty contract |
| --deliverable <path:desc> | Add deliverable (repeatable) |
| --validation <command> | Add validation command (repeatable) |
| --constraint <text> | Add constraint (repeatable) |

---

move

Move a task to a different column.

`
brainfile move --task task-1 --column "In Progress"
brainfile move --task task-5 --column done
`

Options:
| Option | Description |
|--------|-------------|
| -t, --task <id> | Task ID (required) |
| -c, --column <name> | Target column (required) |

---

patch

Update specific fields of a task. Use --clear-* options to remove fields.

`
brainfile patch --task task-1 --priority critical
brainfile patch --task task-1 --title "Updated" --tags "new,tags"
brainfile patch --task task-1 --clear-assignee
`

Options:
| Option | Description |
|--------|-------------|
| -t, --task <id> | Task ID (required) |
| --title <text> | New title |
| --description <text> | New description |
| --priority <level> | New priority |
| --tags <list> | New tags (comma-separated) |
| --assignee <name> | New assignee |
| --due-date <date> | New due date |
| --clear-description | Remove description |
| --clear-priority | Remove priority |
| --clear-tags | Remove tags |
| --clear-assignee | Remove assignee |
| --clear-due-date | Remove due date |

---

delete

Permanently delete a task. Requires confirmation.

`
brainfile delete --task task-1 --force
`

Options:
| Option | Description |
|--------|-------------|
| -t, --task <id> | Task ID (required) |
| --force | Confirm deletion (required) |

---

archive

Move a task to the archive section.

`
brainfile archive --task task-1
`

Options:
| Option | Description |
|--------|-------------|
| -t, --task <id> | Task ID (required) |

---

restore

Restore an archived task to a column.

`
brainfile restore --task task-1 --column todo
`

Options:
| Option | Description |
|--------|-------------|
| -t, --task <id> | Task ID (required) |
| -c, --column <name> | Target column (required) |

---

subtask

Manage subtasks within a task.

`
brainfile subtask --task task-1 --add "New subtask"
brainfile subtask --task task-1 --toggle task-1-1
brainfile subtask --task task-1 --update task-1-1 --title "Updated"
brainfile subtask --task task-1 --delete task-1-2
`

Options:
| Option | Description |
|--------|-------------|
| -t, --task <id> | Parent task ID (required) |
| --add <title> | Add a new subtask |
| --toggle <id> | Toggle subtask completion |
| --update <id> | Update subtask (use with --title) |
| --delete <id> | Delete a subtask |
| --title <text> | New title (for --update) |

---

lint

Validate brainfile syntax and auto-fix issues.

`
brainfile lint              # Check for issues
brainfile lint --fix        # Auto-fix issues
brainfile lint --check      # Exit with error (for CI)
`

Options:
| Option | Description |
|--------|-------------|
| -f, --file <path> | Path to brainfile (default: brainfile.md) |
| --fix | Automatically fix issues |
| --check | Exit with error code if issues found |

What it checks:
  - YAML syntax errors
  - Unquoted strings with colons (auto-fixable)
  - Duplicate column IDs
  - Missing required fields

---

template

Create tasks from built-in templates.

`
brainfile template --list
brainfile template --use bug-report --title "Login fails"
brainfile template --use feature-request --title "Dark mode"
`

Options:
| Option | Description |
|--------|-------------|
| -l, --list | List available templates |
| -u, --use <id> | Create from template |
| --title <text> | Task title (required with --use) |
| --description <text> | Task description |
| -c, --column <name> | Target column (default: todo) |

Built-in Templates:
  - bug-report — Bug tracking with triage steps
  - feature-request — Feature proposals
  - refactor — Code refactoring tasks

---

tui

Launch interactive terminal UI. This is the default when running brainfile without arguments.

`
brainfile              # Opens TUI with brainfile.md
brainfile ./tasks.md   # Opens TUI with specific file
brainfile tui          # Explicit TUI command
`

Keyboard Controls:

| Key | Action |
|-----|--------|
| TAB / Shift+TAB | Navigate columns |
| j/k or ↑/↓ | Navigate tasks |
| Enter | Expand/collapse task |
| / | Search tasks |
| ? | Show help |
| r | Refresh |
| q | Quit |

---

hooks

Install integration hooks for AI coding assistants.

`
brainfile hooks install claude-code
brainfile hooks install cursor --scope project
brainfile hooks install cline
brainfile hooks list
brainfile hooks uninstall claude-code --scope all
`

Supported Assistants:
  - Claude Code
  - Cursor
  - Cline

Options:
| Option | Description |
|--------|-------------|
| --scope <scope> | user (default), project, or all |

---

contract

Manage the lifecycle of agent-to-agent contracts.

`
brainfile contract pickup --task task-1
brainfile contract deliver --task task-1
brainfile contract validate --task task-1
`

Subcommands:
| Command | Description |
|---------|-------------|
| pickup | Claim a task for implementation |
| deliver | Submit completed work for review |
| validate | Run automated validation commands |
| approve | Manually approve work |
| reject | Reject work with feedback |
| attach | Add contract to existing task |
| blocked | Mark as blocked |
| reset | Reset status |

See the Contract Commands Reference for detailed documentation.

---

mcp

Start an MCP (Model Context Protocol) server for AI assistant integration.

`
brainfile mcp
brainfile mcp --file ./project/brainfile.md
`

Options:
| Option | Description |
|--------|-------------|
| -f, --file <path> | Path to brainfile (default: brainfile.md) |

Available MCP Tools:

| Tool | Description |
|------|-------------|
| list_tasks | List tasks with optional filtering |
| add_task | Create a new task |
| move_task | Move task between columns |
| patch_task | Update task fields |
| delete_task | Permanently delete a task |
| archive_task | Archive a task |
| restore_task | Restore from archive |
| add_subtask | Add a subtask |
| delete_subtask | Delete a subtask |
| toggle_subtask | Toggle subtask completion |
| update_subtask | Update subtask title |

---

Global Options

| Option | Description |
|--------|-------------|
| --help | Display help for command |
| --version | Display CLI version |

Exit Codes

| Code | Meaning |
|------|---------|
| 0 | Success |
| 1 | Error (invalid arguments, file not found) |
| 2 | Validation error (with lint --check) |

---

CI/CD Integration

GitHub Actions

`
name: Validate Brainfile
on: [push, pull_request]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
  - uses: actions/checkout@v4
  - name: Validate
        run: npx @brainfile/cli lint --check
`

Pre-commit Hook

`
#!/bin/bash

.git/hooks/pre-commit

if [ -f "brainfile.md" ]; then
  npx @brainfile/cli lint --check
  if [ $? -ne 0 ]; then
    echo "brainfile.md has validation errors"
    exit 1
  fi
fi
`

npm Scripts

`
{
  "scripts": {
    "tasks": "brainfile list",
    "tasks:lint": "brainfile lint --fix",
    "precommit": "brainfile lint --check"
  }
}
``

---

Next Steps
  - CLI & TUI Guide — Getting started with the CLI
  - MCP Server — AI assistant integration
  - Protocol Specification — File format details

---

## 13. Contract Schema Reference

Contract Schema Reference

The Contract object is an optional extension to a Brainfile task. It defines the formal agreement between a requester (PM) and a worker (Agent).

Source of Truth: contract.json

Object Structure

| Field | Type | Description | Required |
|-------|------|-------------|----------|
| status | string | Current lifecycle state (see below) | Yes |
| deliverables | Array<Deliverable> | List of items to be produced | No |
| validation | Validation | How to verify the work | No |
| constraints | Array<string> | Implementation rules to follow | No |
| context | Context | Additional background information | No |

Lifecycle Status (status)

Contracts follow a strict state machine to coordinate between different agents.
  - draft: Contract is being defined.
  - ready: Work is defined and available for an agent to pick up.
  - in_progress: An agent has claimed the task and is working on it.
  - delivered: Work is completed and submitted for validation.
  - done: Work has passed validation and is finalized.
  - failed: Work failed validation or was abandoned.

Deliverable Object

Each item in the deliverables array defines a specific output.

| Field | Type | Description |
|-------|------|-------------|
| type | string | Category (e.g., file, test, docs, refactor) |
| path | string | Path to the file or identifier for the deliverable |
| description| string | (Optional) Human-readable explanation |

Validation Object

| Field | Type | Description |
|-------|------|-------------|
| commands | Array<string> | Shell commands to execute for validation |

Context Object

Used to provide deeper understanding to the worker agent.

| Field | Type | Description |
|-------|------|-------------|
| background | string | High-level "why" and architectural context |
| relevantFiles| Array<string>| Paths to existing code for reference |
| outOfScope | Array<string>| Explicitly forbidden changes |

---

Example (YAML)

When stored in brainfile.md, a contract looks like this:

``
id: task-63
title: "Update API documentation"
contract:
  status: ready
  deliverables:
  - type: docs
      path: docs/api-v2.md
      description: "Updated REST endpoints"
  validation:
    commands:
  - npm run docs:verify
  constraints:
  - Use Swagger/OpenAPI 3.0 format
  - Document all error codes
  context:
    background: "Preparing for the Q3 mobile app release"
    relevantFiles:
  - src/routes/api.ts
    outOfScope:
  - Changing the authentication logic
``

---

## 14. Schema Types

Schema Types

Brainfile uses JSON Schema to define the structure of task boards.

Available Schemas

| Schema | URL | Purpose |
|--------|-----|---------|
| Base | /v1/base.json | Shared fields (title, agent, rules) |
| Board | /v1/board.json | Kanban task management |
| Contract | /v1/contract.json | Task contract object (task.contract) |

---

Board (Default)

Kanban-style task boards with columns and draggable tasks.

``
---
type: board
schema: https://brainfile.md/v1/board.json
title: My Project
columns:
  - id: todo
    title: To Do
    tasks:
  - id: task-1
        title: Implement feature
        priority: high
---
`

Structure: columns[] containing tasks[]

Renderer: Kanban board with columns

View Board Schema · Example

---

Contract (Task Extension)

Task contracts define structured deliverables, validation commands, and constraints for PM-to-agent workflows.

`
contract:
  status: ready
  deliverables:
  - type: file
      path: src/feature.ts
      description: Implementation
  validation:
    commands:
  - npm test
`

View Contract Schema · Docs

---

Base Schema

All brainfiles inherit from the base schema which defines shared fields:

`
---
title: string           # Required
type: string            # Optional (defaults to board)
schema: string          # Optional JSON schema URL
protocolVersion: string # Optional version string
agent:
  instructions: []
  llmNotes: string
  tools: {}
rules:
  always: []
  never: []
  prefer: []
  context: []
---
`

View Base Schema

---

Type Inference

When type is not specified, tools determine the type by:
  Schema URL — /v1/board.json → board
  Filename suffix — project.board.md → board
  Structural analysis — columns[] present → board
  Default → board

---

Schema Directory

Browse all schemas at brainfile.md/v1/

`
{
  "schemas": {
    "base": { "url": "https://brainfile.md/v1/base.json" },
    "board": { "url": "https://brainfile.md/v1/board.json" }
  }
}
``

---

Next Steps
  - Protocol Specification — File format details
  - API Reference — Library documentation
  - Core Library — Build custom tools

---

## 15. Complete Example

Full example from protocol/example/brainfile.md:

```yaml
---
title: Example Project Board
schema: https://brainfile.md/v1/board.json
agent:
  instructions:
    - This is an example board demonstrating Brainfile features
    - Shows various task metadata fields (priority, assignee, tags)
    - Demonstrates multi-column workflow
statsConfig:
  columns:
    - todo
    - in-progress
    - review
    - done
rules:
  always:
    - id: 1
      rule: write tests for all new features
    - id: 2
      rule: update documentation when changing APIs
    - id: 3
      rule: run linter before committing code
  never:
    - id: 1
      rule: deploy without running tests
    - id: 2
      rule: commit directly to main branch
  prefer:
    - id: 1
      rule: functional components over class components
    - id: 2
      rule: TypeScript over JavaScript for new files
    - id: 3
      rule: descriptive variable names over comments
columns:
  - id: todo
    title: To Do
    tasks:
      - id: task-2
        title: Design dashboard UI
        description: Create responsive dashboard layout with charts and widgets
        priority: high
        assignee: bob
        tags:
          - frontend
          - ui
          - design
      - id: task-3
        title: Write API documentation
        description: Document all REST endpoints with examples
        priority: medium
        assignee: charlie
        tags:
          - docs
          - api
      - id: task-1
        title: Implement user authentication
        description: Add JWT-based authentication system with refresh tokens
        priority: critical
        assignee: alice
        tags:
          - backend
          - security
          - auth
  - id: in-progress
    title: In Progress
    tasks:
      - id: task-4
        title: Database Schema Design for Go
        description: |-
          * Define tables and relationships
          * Document constraints
          * Create migration scripts
        priority: high
        assignee: david
        tags:
          - backend
          - database
  - id: review
    title: Review
    tasks:
      - id: task-6
        title: Refactor user service
        description: Clean up user service code and improve error handling
        priority: low
        assignee: alice
        tags:
          - backend
          - refactoring
      - id: task-7
        title: Update dependencies
        description: Upgrade all npm packages to latest stable versions
        priority: low
        assignee: charlie
        tags:
          - maintenance
          - dependencies
  - id: done
    title: Done
    tasks:
      - id: task-10
        title: Implement dark mode
        description: Add dark theme support with system preference detection
        priority: medium
        assignee: bob
        tags:
          - frontend
          - ui
          - theme
      - id: task-5
        title: Optimize image loading
        description: Implement lazy loading for gallery images
        priority: medium
        assignee: bob
        tags:
          - frontend
          - performance
          - optimization
      - id: task-8
        title: Project Setup
        description: Initialize repository and configure development environment
        priority: high
        tags:
          - setup
          - devops
      - id: task-9
        title: CI Pipeline
        description: Set up continuous integration workflow with GitHub Actions
        priority: high
        assignee: david
        tags:
          - devops
          - ci-cd
          - automation
---

```

---

## Support & Resources

- **Website**: https://brainfile.md
- **Quick Reference**: https://brainfile.md/llms.txt
- **Schema**: https://brainfile.md/v1
- **GitHub**: https://github.com/brainfile
- **Issues**: https://github.com/brainfile/protocol/issues
- **Discussions**: https://github.com/brainfile/protocol/discussions

---

End of Complete Reference
Auto-generated from markdown documentation
