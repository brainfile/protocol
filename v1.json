{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://brainfile.md/v1",
  "title": "Brainfile Task Description Language (TDL)",
  "description": "Schema for brainfile.md YAML frontmatter - a protocol for project task management",
  "type": "object",
  "required": ["title", "columns"],
  "properties": {
    "protocolVersion": {
      "type": "string",
      "description": "Version of the Brainfile protocol this file uses",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "default": "0.4.0"
    },
    "schema": {
      "type": "string",
      "description": "Reference to the Brainfile schema for validation. Can be a remote URI (https://) or local file path (relative or absolute)",
      "oneOf": [
        {
          "pattern": "^https?://",
          "description": "Remote schema URL"
        },
        {
          "pattern": "^[^:]+$",
          "description": "Local file path (relative or absolute)"
        }
      ],
      "examples": [
        "https://brainfile.md/v1",
        "https://raw.githubusercontent.com/brainfile/protocol/refs/heads/main/brainfile.schema.json",
        "brainfile.schema.json",
        "./schemas/brainfile.schema.json",
        "/usr/local/share/brainfile/schema.json"
      ]
    },
    "title": {
      "type": "string",
      "description": "Project or board title",
      "minLength": 1
    },
    "agent": {
      "type": "object",
      "description": "Instructions for AI agents interacting with the board",
      "properties": {
        "instructions": {
          "type": "array",
          "description": "List of instructions for agents",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "llmNotes": {
          "type": "string",
          "description": "Free-form notes about how this project prefers AI work to be structured"
        }
      },
      "additionalProperties": false
    },
    "rules": {
      "type": "object",
      "description": "Project rules organized by category",
      "properties": {
        "always": {
          "type": "array",
          "description": "Rules that must always be followed",
          "items": {
            "$ref": "#/definitions/rule"
          }
        },
        "never": {
          "type": "array",
          "description": "Rules that must never be violated",
          "items": {
            "$ref": "#/definitions/rule"
          }
        },
        "prefer": {
          "type": "array",
          "description": "Preferred approaches or patterns",
          "items": {
            "$ref": "#/definitions/rule"
          }
        },
        "context": {
          "type": "array",
          "description": "Contextual information and constraints",
          "items": {
            "$ref": "#/definitions/rule"
          }
        }
      },
      "additionalProperties": false
    },
    "columns": {
      "type": "array",
      "description": "Task columns (e.g., To Do, In Progress, Done)",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/column"
      }
    }
  },
  "additionalProperties": false,
  "definitions": {
    "rule": {
      "type": "object",
      "required": ["id", "rule"],
      "properties": {
        "id": {
          "type": "integer",
          "description": "Unique identifier within the rule category",
          "minimum": 1
        },
        "rule": {
          "type": "string",
          "description": "The rule text",
          "minLength": 1
        }
      },
      "additionalProperties": false
    },
    "column": {
      "type": "object",
      "required": ["id", "title", "tasks"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique column identifier in kebab-case (e.g., 'todo', 'in-progress')",
          "pattern": "^[a-z]+(-[a-z]+)*$",
          "minLength": 1
        },
        "title": {
          "type": "string",
          "description": "Display title for the column",
          "minLength": 1
        },
        "tasks": {
          "type": "array",
          "description": "Tasks in this column",
          "items": {
            "$ref": "#/definitions/task"
          }
        }
      },
      "additionalProperties": false
    },
    "task": {
      "type": "object",
      "required": ["id", "title"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique task identifier following pattern 'task-N'",
          "pattern": "^task-[0-9]+$"
        },
        "title": {
          "type": "string",
          "description": "Task title",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "description": "Optional detailed task description (supports Markdown)"
        },
        "assignee": {
          "type": "string",
          "description": "Optional task assignee"
        },
        "tags": {
          "type": "array",
          "description": "Optional task tags",
          "items": {
            "type": "string"
          }
        },
        "priority": {
          "type": "string",
          "description": "Optional task priority",
          "enum": ["low", "medium", "high", "critical"]
        },
        "effort": {
          "type": "string",
          "description": "Optional effort estimation for AI planning",
          "enum": ["trivial", "small", "medium", "large", "xlarge"]
        },
        "blockedBy": {
          "type": "array",
          "description": "Optional list of task IDs that block this task",
          "items": {
            "type": "string",
            "pattern": "^task-[0-9]+$"
          }
        },
        "dueDate": {
          "type": "string",
          "description": "Optional due date in ISO 8601 format",
          "format": "date"
        },
        "relatedFiles": {
          "type": "array",
          "description": "Optional list of related file paths or code locations",
          "items": {
            "type": "string"
          }
        },
        "subtasks": {
          "type": "array",
          "description": "Optional list of subtasks for tracking granular progress",
          "items": {
            "$ref": "#/definitions/subtask"
          }
        },
        "template": {
          "type": "string",
          "description": "Optional task template type",
          "enum": ["bug", "feature", "refactor"]
        }
      },
      "additionalProperties": false
    },
    "subtask": {
      "type": "object",
      "required": ["id", "title", "completed"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique subtask identifier, typically 'task-N-M' pattern",
          "minLength": 1
        },
        "title": {
          "type": "string",
          "description": "Subtask title",
          "minLength": 1
        },
        "completed": {
          "type": "boolean",
          "description": "Whether the subtask is completed"
        }
      },
      "additionalProperties": false
    }
  }
}
